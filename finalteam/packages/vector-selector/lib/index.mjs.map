{"version":3,"file":"index.mjs","sources":["../src/tools.ts","../src/extract_query.ts","../src/select.ts","../src/utils.ts","../src/index.ts"],"sourcesContent":[null,null,null,null,null],"names":["Tools","extract_query","type","function","name","description","parameters","properties","query_list","items","reason","query","required","select_functions","function_list","function_name","async","extractQuery","ctx","completionStream","request","messages","role","content","join","histories","map","factory","flat","prompt","contents","decodeUserMessageContent","tool_choice","tools","chunks","utils","StreamUtil","readAll","completion","ChatGptCompletionMessageUtil","merge","queries","choices","message","tool_calls","flatMap","v","arg","JSON","parse","arguments","Array","isArray","selectFunction","props","toolList","prevFailures","restRetry","selectCompletion","AgenticaDefaultPrompt","write","config","id","stringify","tool_call_id","systemPrompt","select","AgenticaSystemPrompt","SELECT","emendMessages","parallel_tool_calls","then","toolCalls","filter","length","forEach","event","creatAssistantMessageEvent","stream","toAsyncGenerator","done","get","dispatch","failures","reduce","acc","cur","tc","errors","push","path","expected","value","idx","validation","data","feedback","Error","operation","operations","undefined","selection","createOperationSelection","stack","createSelectEvent","f","uniqBy","array","selector","seen","Set","item","key","has","add","BootAgenticaVectorSelector","isEmbedded","setEmbedded","useEmbeddedContext","searchTool","embedContext","strategy","selectorExecute","Promise","all","res","op","protocol","method","tags","arr","set"],"mappings":"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"}